<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MBBS Flashcards</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 2rem;
      background-color: #f0f8ff;
      color: #333;
    }

    h1 {
      text-align: center;
      color: #0077b6;
    }

    .card-form, .quiz-section, .card-list {
      max-width: 600px;
      margin: auto;
      margin-bottom: 2rem;
      background: white;
      padding: 1rem;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    input, select, button {
      width: 100%;
      padding: 0.75rem;
      margin-bottom: 1rem;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    button {
      background-color: #0077b6;
      color: white;
      cursor: pointer;
    }

    .flashcard {
      background: #e0f7fa;
      padding: 1rem;
      margin: 0.5rem 0;
      border-radius: 8px;
    }

    .flashcard-actions {
      margin-top: 0.5rem;
    }

    .quiz-section input {
      margin-top: 1rem;
    }

    img {
      max-width: 100%;
      margin-top: 1rem;
    }

    .quiz-feedback {
      margin-top: 1rem;
    }

    .timer {
      font-size: 1.2rem;
      color: red;
    }

  </style>
</head>
<body>
  <h1>MBBS Flashcards</h1>

  <div class="card-form">
    <h3>Add a Flashcard</h3>
    <input type="text" id="question" placeholder="Enter question">
    <input type="text" id="answer" placeholder="Enter answer">
    <input type="text" id="subject" placeholder="Enter subject (e.g. Anatomy)">
    <input type="file" id="flashcardImage" accept="image/*,application/pdf">
    <button onclick="addFlashcard()">Add</button>
  </div>

  <div class="card-list">
    <h3>My Flashcards</h3>
    <label for="filterSubject">Filter by Subject:</label>
    <select id="filterSubject" onchange="renderCards()">
      <option value="">All</option>
    </select>
    <div id="cardsContainer"></div>
  </div>

  <div class="quiz-section">
    <h3>Quiz Mode</h3>
    <div id="quizCard"></div>
    <input type="text" id="userAnswer" placeholder="Your answer">
    <button onclick="checkAnswer()">Check Answer</button>
    <p id="quizFeedback" class="quiz-feedback"></p>
    <p id="score">Score: 0</p>
    <p id="timer" class="timer"></p>
  </div>

  <script>
    let flashcards = [];
    let currentQuizIndex = 0;
    let score = 0;
    let timerInterval;
    let timeRemaining = 10;

    function saveToLocalStorage() {
      localStorage.setItem("mbbsFlashcards", JSON.stringify(flashcards));
    }

    function loadFromLocalStorage() {
      const data = localStorage.getItem("mbbsFlashcards");
      if (data) {
        flashcards = JSON.parse(data);
      }
    }

    function addFlashcard() {
      const question = document.getElementById("question").value.trim();
      const answer = document.getElementById("answer").value.trim();
      const subject = document.getElementById("subject").value.trim();
      const fileInput = document.getElementById("flashcardImage");
      const file = fileInput.files[0];

      if (!question || !answer || !subject) return alert("All fields required");

      let imageUrl = null;
      if (file) {
        if (file.type.startsWith('image')) {
          const reader = new FileReader();
          reader.onload = function(event) {
            imageUrl = event.target.result;
            flashcards.push({ question, answer, subject, imageUrl });
            saveToLocalStorage();
            renderCards();
            showNextQuizCard();
          };
          reader.readAsDataURL(file);
        } else if (file.type === 'application/pdf') {
          imageUrl = URL.createObjectURL(file);
          flashcards.push({ question, answer, subject, imageUrl });
          saveToLocalStorage();
          renderCards();
          showNextQuizCard();
        }
      } else {
        flashcards.push({ question, answer, subject });
        saveToLocalStorage();
        renderCards();
        showNextQuizCard();
      }

      document.getElementById("question").value = "";
      document.getElementById("answer").value = "";
      document.getElementById("subject").value = "";
      document.getElementById("flashcardImage").value = "";
    }

    function deleteFlashcard(index) {
      if (confirm("Delete this flashcard?")) {
        flashcards.splice(index, 1);
        saveToLocalStorage();
        renderCards();
      }
    }

    function editFlashcard(index) {
      const newQ = prompt("Edit Question:", flashcards[index].question);
      const newA = prompt("Edit Answer:", flashcards[index].answer);
      const newS = prompt("Edit Subject:", flashcards[index].subject);
      if (newQ !== null && newA !== null && newS !== null) {
        flashcards[index] = { question: newQ.trim(), answer: newA.trim(), subject: newS.trim() };
        saveToLocalStorage();
        renderCards();
      }
    }

    function renderCards() {
      const container = document.getElementById("cardsContainer");
      const filter = document.getElementById("filterSubject").value.toLowerCase();
      container.innerHTML = "";
      const uniqueSubjects = new Set();

      flashcards.forEach((card, index) => {
        uniqueSubjects.add(card.subject);
        if (!filter || card.subject.toLowerCase() === filter) {
          const div = document.createElement("div");
          div.className = "flashcard";
          div.innerHTML = `<strong>${card.question}</strong><br><em>Subject: ${card.subject}</em><br><em>Click to see answer</em>`;

          if (card.imageUrl) {
            if (card.imageUrl.endsWith('.pdf')) {
              div.innerHTML += `<a href="${card.imageUrl}" target="_blank">View PDF</a>`;
            } else {
              div.innerHTML += `<img src="${card.imageUrl}" alt="Flashcard Image">`;
            }
          }

          div.onclick = () => alert(`Answer: ${card.answer}`);

          const actions = document.createElement("div");
          actions.className = "flashcard-actions";

          const editBtn = document.createElement("button");
          editBtn.textContent = "Edit";
          editBtn.onclick = (e) => {
            e.stopPropagation();
            editFlashcard(index);
          };

          const deleteBtn = document.createElement("button");
          deleteBtn.textContent = "Delete";
          deleteBtn.onclick = (e) => {
            e.stopPropagation();
            deleteFlashcard(index);
          };

          actions.appendChild(editBtn);
          actions.appendChild(deleteBtn);
          div.appendChild(actions);
          container.appendChild(div);
        }
      });

      const filterDropdown = document.getElementById("filterSubject");
      const existingOptions = Array.from(filterDropdown.options).map(o => o.value.toLowerCase());
      uniqueSubjects.forEach(subject => {
        if (!existingOptions.includes(subject.toLowerCase())) {
          const opt = document.createElement("option");
          opt.value = subject;
          opt.textContent = subject;
          filterDropdown.appendChild(opt);
        }
      });
    }

    function showNextQuizCard() {
      if (flashcards.length === 0) return;
      currentQuizIndex = Math.floor(Math.random() * flashcards.length);
      const card = flashcards[currentQuizIndex];
      document.getElementById("quizCard").innerText = card.question + ` (Subject: ${card.subject})`;
      document.getElementById("userAnswer").value = "";
      document.getElementById("quizFeedback").innerText = "";
      startTimer();
    }

    function checkAnswer() {
      const userAns = document.getElementById("userAnswer").value.trim().toLowerCase();
      const correctAns = flashcards[currentQuizIndex].answer.toLowerCase();
      const feedback = document.getElementById("quizFeedback");

      if (userAns === correctAns) {
        score++;
        feedback.innerText = "Correct!";
      } else {
        feedback.innerText = `Wrong. Correct answer is: ${flashcards[currentQuizIndex].answer}`;
      }

      document.getElementById("score").innerText = `Score: ${score}`;

      setTimeout(() => {
        showNextQuizCard();
      }, 2000);
    }

    function startTimer() {
      timeRemaining = 10; // Reset timer
      document.getElementById("timer").innerText = `Time remaining: ${timeRemaining}s`;

      if (timerInterval) clearInterval(timerInterval);

      timerInterval = setInterval(() => {
        if (timeRemaining <= 0) {
          clearInterval(timerInterval);
          document.getElementById("quizFeedback").innerText = "Time's up! Correct answer: " + flashcards[currentQuizIndex].answer;
          setTimeout(showNextQuizCard, 2000);
        } else {
          timeRemaining--;
          document.getElementById("timer").innerText = `Time remaining: ${timeRemaining}s`;
        }
      }, 1000);
    }

    document.addEventListener("DOMContentLoaded", () => {
      loadFromLocalStorage();
      renderCards();
      showNextQuizCard();
    });
  </script>
</body>
</html>
